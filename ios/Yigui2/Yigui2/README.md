# YigUi 依柜应用

## 概述
YigUi（依柜）是一款时尚设计与虚拟试穿应用，提供3D服装模型的创建、定制与试穿体验。

## 最新更新 (2025-05-25)

### 🎯 问题解决总结

#### ✅ 已解决的问题

1. **注册验证码发送问题**
   - 问题：客户端显示400错误
   - 解决：服务器API工作正常，问题可能在于特定邮箱已注册
   - 状态：✅ 服务器API测试正常

2. **模型解压失败问题**
   - 问题：iOS平台缺少zip解压功能
   - 解决：移除Archive框架依赖，实现iOS原生解压方法
   - 状态：✅ 已修复并编译成功

3. **本地模型文件缺失问题**
   - 问题：应用启动时尝试复制已删除的本地模型文件
   - 解决：移除本地模型文件复制逻辑，只使用服务器下载的模型
   - 状态：✅ 已修复

4. **用户身高体重数据异常问题**
   - 问题：模型生成时输入异常数据（11cm，1kg）
   - 解决：添加输入验证和调试信息
   - 状态：✅ 已添加验证逻辑

#### 🔧 服务器配置更新

**服务器信息：**
- 服务器地址：150.109.41.198
- 域名：yiguiapp.xyz
- 用户认证服务：运行在8001端口
- 模型生成服务：运行在8000端口
- 数据库：MySQL，用户名yigui_user，数据库名yigui

**服务器端修复：**
- ✅ 修复model_utils.py中的URL生成，从HTTP改为HTTPS
- ✅ 配置nginx正确代理模型文件路径
- ✅ 修复文件权限问题，nginx以root用户运行
- ✅ 确保模型文件可通过HTTPS正常访问

### 📱 客户端更新内容

#### 1. **NetworkService.swift 更新**
- ✅ 更新baseURL为 `https://yiguiapp.xyz/api`
- ✅ 修改注册流程为两步式：
  - 第一步：`emailRegister()` - 发送验证码
  - 第二步：`verifyEmailCode()` - 验证码验证
- ✅ 更新登录流程以适配服务器API
- ✅ 简化用户信息获取（服务器暂无/me端点）

#### 2. **ModelGenerationService.swift 更新**
- ✅ 更新模型生成服务端点为 `https://yiguiapp.xyz/generate`
- ✅ 修复HTTP到HTTPS的自动转换
- ✅ 移除Archive框架依赖，实现iOS原生zip解压
- ✅ 优化GLB模型下载和解压流程

#### 3. **ModelViewModel.swift 更新**
- ✅ 添加用户身高体重数据验证
- ✅ 添加详细的调试信息
- ✅ 改进错误处理和用户提示

#### 4. **AuthViewModel.swift 更新**
- ✅ 修改注册流程：先输入邮箱和密码，再发送验证码
- ✅ 注册成功后自动登录
- ✅ 优化用户信息处理

#### 5. **SignInView.swift 更新**
- ✅ 重新设计注册表单UI
- ✅ 用户需要先输入完整信息再发送验证码
- ✅ 添加重新发送验证码功能

#### 6. **应用启动优化**
- ✅ 移除已删除的本地模型文件复制逻辑
- ✅ 只创建必要的目录结构
- ✅ 清理无用的文件引用

### 🔧 服务器管理命令

**启动服务：**
```bash
# 启动用户认证服务
cd /root/user-server
nohup uvicorn auth_api:app --host 0.0.0.0 --port 8001 > log.txt 2>&1 &

# 启动模型生成服务
cd /root/model-server
nohup uvicorn main:app --host 0.0.0.0 --port 8000 > log.txt 2>&1 &
```

**关闭服务：**
```bash
# 关闭用户认证服务
pkill -f "uvicorn auth_api:app"

# 关闭模型生成服务
pkill -f "uvicorn main:app"
```

### 📋 当前状态

#### ✅ 正常功能
- 邮箱登录功能正常
- 模型文件可通过HTTPS下载
- 应用编译成功，无错误
- 服务器API响应正常
- 用户数据验证已添加

#### ⚠️ 需要注意的问题
1. **注册验证码发送**：需要使用未注册的邮箱进行测试
2. **模型生成**：需要确保用户在个人中心设置有效的身高体重信息
3. **服务器管理**：请手动管理uvicorn服务的启动和关闭

### 🔄 测试建议

1. **注册测试**：使用新的邮箱地址进行注册测试
2. **模型生成测试**：
   - 先在个人中心设置身高体重（如：身高175cm，体重70kg）
   - 然后在模型页面点击"创建模型"
3. **登录测试**：使用已注册的账号进行登录测试

### 🛠️ 技术栈

- **前端**：SwiftUI, SceneKit, CoreML
- **后端**：FastAPI, Python
- **数据库**：MySQL
- **服务器**：Ubuntu, Nginx
- **3D处理**：Blender, GLB格式

### 📝 开发环境

- iOS 16.6+
- Xcode 15+
- Swift 5.0+

### 🔍 故障排除

**如果遇到注册问题：**
1. 检查邮箱是否已注册
2. 确认网络连接正常
3. 查看控制台日志获取详细错误信息

**如果遇到模型生成问题：**
1. 确认输入的身高体重数值合理（身高：50-250cm，体重：20-300kg）
2. 检查服务器模型生成服务状态
3. 尝试重新生成模型

**如果遇到网络连接问题：**
1. 检查网络连接
2. 确认服务器状态
3. 查看控制台日志获取详细错误信息

---

## 编译状态：✅ 成功

项目已成功编译，可以在iOS模拟器和真机上运行。所有主要功能已更新以连接到新的服务器。
