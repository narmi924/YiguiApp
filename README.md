如有技术问题或功能建议，请联系Imranjan Mamtimin：[![点击联系](https://img.shields.io/badge/点击联系-ECEBDE)](https://www.imranjan.cn/about)。

# **移动应用创新赛源码**

这是完整的基于Swift语言开发的，具有人物建模、服装设计、服装试穿等功能的iOS软件的代码备份。

它构建了一条完整的"真实人体参数 → 智能3D建模 → 个性化服装设计 → 虚拟试穿"全链路体验，让每一位用户都能基于自己独一无二的身体，成为自己"虚拟分身"的专属服装设计师。

项目以解决普通消费者难以参与服装创作、成衣尺码不符、线上试衣体验不佳等痛点问题为目标。

## 技术架构概览

### 前端技术栈
- **平台：** iOS 16.6+
- **开发工具：** Xcode 15+
- **编程语言：** Swift 5.0+
- **核心框架：**
  - SwiftUI（用户界面）
  - SceneKit（3D渲染与展示）
  - CoreML（本地机器学习推理）
  - GLTFSceneKit（3D模型加载）

### 后端技术栈
- **Web框架：** FastAPI（Python）
- **数据库：** MySQL + SQLite
- **服务器：** Ubuntu + Nginx
- **3D处理：** Blender 3.6.5
- **文件格式：** GLB格式
- **安全认证：** HTTPS + JWT认证
- **异步任务：** Dramatiq + Redis


## 文件结构

### 项目结构
```
YiguiApp/ios/Yigui2/Yigui2
├── Views/              # 视图层
├── ViewModels/         # 视图模型层
├── Services/           # 服务层
│   ├── NetworkService.swift
│   ├── ModelGenerationService.swift
│   ├── BodyShapePredictorService.swift
│   └── ...
├── Models/             # 数据模型
├── Resources/          # 资源文件
└── Assets.xcassets/    # 图像资源
```

### 服务器项目结构（请移步至“yigui-server”仓库，[![点击跳转](https://img.shields.io/badge/yigui_server_仓库-D7D3BF)](https://github.com/narmi924/yigui-server)）
```
├── user-server/       # 用户认证服务
├── model-server/      # 3D模型处理服务
├── design-server/     # 服装设计服务
└── configs/           # 配置文件
```

## 核心功能详解

### 1. 专属虚拟形象生成

#### 技术实现
- **输入方式：** 用户仅需输入身高、体重、昵称等基础信息
- **处理流程：** CoreML 本地预测 + 后端装配的创新流程

#### 核心创新：本地化CoreML部署
- 将`胸围`、`腰围`、`大腿围`三个关键比例的预测模型直接部署在App内
- 模型文件：`Chest_Ratio.mlmodel`、`Waist_Ratio.mlmodel`、`Thigh_Ratio.mlmodel`
- 响应速度：数秒内生成与用户真实身材比例高度一致的专属3D虚拟形象
- 隐私保护：身高、体重等核心隐私数据无需离开用户设备，支持离线使用

#### "迭代收敛"预测算法
**核心问题：** 人体各部位比例存在复杂的循环依赖关系（如胸围大小会影响腰围的视觉比例）

**解决方案：** 设计了3轮循环计算的迭代收敛算法
1. 使用默认值或上一轮结果作为输入
2. **预测胸围：** 将`身高`、`体重`、`腰围比例`、`大腿围比例`输入`Chest_Ratio.mlmodel`
3. **预测腰围：** 使用**上一步新预测的胸围**，连同其他参数输入`Waist_Ratio.mlmodel`
4. **预测大腿围：** 使用**更新后的胸围和腰围**，输入`Thigh_Ratio.mlmodel`
5. 重复此过程3次，使结果趋于稳定和精确

### 2. 简洁直观的服装设计

#### 基础版型
- 目前提供`卫衣`、`T恤`、`裤子`、`短裤`四种基础版型
- 基础模型键：`shorts_female`、`shirt_male`、`pant_male`、`sweatshirt_female`

#### 设计方式
- **纯色设计：** 像"填色游戏"一样轻松为服装更换纯色
- **自定义印花：** 从手机相册上传任意图片作为自定义印花
- **设计类型：** `color`（颜色）、`texture`（纹理）

#### 数据存储
- 所有设计参数（如颜色、印花贴图路径）都会被记录在数据库的`DesignProject`表中
- 支持项目命名和状态管理

### 3. 云端衣柜与一键试穿

#### 云端存储
- 用户的每一件设计作品都会被保存在"我的衣柜"中
- 按`上装`、`下装`等类别清晰分类
- 云端同步，随时访问

#### 一键试穿
- 用户可以随时在衣柜中选择任意作品，点击"试穿"
- 触发后端的"虚拟装配"流程
- 将该服装"穿"在自己的3D模型上进行实时预览和搭配

#### 版本管理
- 用户可以保存多个版本的3D模型和设计作品
- 自由切换当前激活的模型

## 技术创新亮点

### 1. 隐私优先的本地推断与"迭代收敛"算法

**核心服务：** `BodyShapePredictorService`

**创新点：**
- 在iOS客户端本地通过CoreML完成身体比例预测
- 身高、体重等核心隐私数据全程留存在用户设备
- 从根本上保障了用户隐私安全
- 支持离线使用

**技术优势：**
- 将复杂的机器学习推理任务本地化
- 避免敏感数据网络传输
- 响应速度更快
- 用户体验更流畅

### 2. 高效的云端"虚拟装配"技术

**核心概念：** 基于Blender打造的"先拆解、再缩放、后重组"的虚拟装配模式

**技术实现：**
- **原子化部件处理：** 将人物模型"原子化"为`身体`、`上衣`、`裤子`等独立部件
- **独立缩放：** 每个部件独立进行非破坏性的骨骼缩放和网格调整
- **首次生成流程：** 通过`merge_parts.py`脚本将缩放好的部件重新组装成完整的数字人模型
- **智能试穿优化：** 仅用新的服装部件替换对应部位，与原有的身体等"旧零件"进行快速重组

**性能优势：**
- 极大提升了模型处理的复用性和效率
- 大幅缩短每次试穿的后台处理时间
- 实现流畅的虚拟试穿体验

### 3. 客户端与服务器的异步通信机制

**核心服务：** `ModelGenerationService`

**异步任务队列流程：**
1. 客户端调用`generateModelAsync`方法发送请求
2. 服务器接收请求后立即创建后台任务，返回唯一的`task_id`
3. 客户端通过`pollTaskStatus`方法轮询检查任务状态
4. 实时显示任务进度（"processing", "completed"等）

**用户体验优化：**
- 避免长时间等待导致的UI卡顿或假死
- 用户可以随时看到任务的实时进度
- 极大地优化了用户体验

## iOS客户端核心架构

### 服务层架构
- **NetworkService.swift：** 网络通信服务
- **ModelGenerationService.swift：** 模型生成服务
- **ModelCacheService.swift：** 模型缓存服务
- **DesignService.swift：** 设计服务
- **BodyShapePredictorService.swift：** 身体形状预测服务

### 数据模型
- **User.swift：** 用户数据模型
- **Model3D.swift：** 3D模型数据模型
- **Clothes.swift：** 服装数据模型
- **Model3DLoader.swift：** 3D模型加载器

### 依赖管理
- **GLTFSceneKit：** 用于加载和渲染GLB/GLTF格式的3D模型
- 版本要求：0.4.0+

## 数据库设计

### 核心数据表

#### 用户相关
- `users` - 用户基本信息表
- `avatars` - 用户头像记录表

#### 模型相关
- `user_characters` - 用户3D模型记录表
- `task_status` - 异步任务状态表

#### 设计相关
- `design_projects` - 设计项目表
- `patterns` - 纸样库表
- `design_patterns` - 设计纸样关联表

## 3D处理流程

### 模型生成流程
1. **输入处理：** 接收用户身高、体重、身体比例参数
2. **部件缩放：** 使用Blender脚本对基础模型部件进行个性化缩放
3. **部件合并：** 将处理后的头部、身体、服装部件合并
4. **GLB导出：** 生成最终的GLB格式3D模型文件
5. **数据库记录：** 保存模型信息和访问URL

### 服装试穿流程
1. **设计选择：** 用户选择云端衣柜中的服装设计
2. **虚拟装配：** 后端将服装模型与用户3D形象进行装配
3. **实时渲染：** 生成试穿效果的3D模型
4. **结果返回：** 返回试穿效果供用户预览

## 服务器部署架构

### 环境要求
- **操作系统：** Ubuntu
- **Web服务器：** Nginx
- **SSL证书：** Let's Encrypt (Certbot)
- **Python环境：** Python 3.10+
- **3D软件：** Blender 3.6.5

### 服务启动脚本
```bash
# 启动用户服务
cd user-server/
nohup uvicorn auth_api:app --host 0.0.0.0 --port 8001 > log.txt 2>&1 &

# 启动模型服务
cd model-server/
./manage_model_server.sh start

# 启动设计服务
cd design-server/
./manage_design_server.sh start
```

### Nginx配置
- 反向代理配置，将不同路径路由到对应的微服务
- HTTPS配置和SSL证书管理
- 静态文件服务（头像、3D模型文件等）

## 技术特色与创新

### 技术创新
1. **移动端3D建模：** 首创在移动设备上实现个性化3D人体建模
2. **隐私保护机制：** 身体数据本地处理，保护用户隐私
3. **高效渲染引擎：** 基于Blender的云端自动化渲染管线
4. **模块化架构：** 微服务架构实现服务解耦和弹性扩展
5. **迭代收敛算法：** 解决人体比例预测的循环依赖问题

### 用户体验创新
1. **零门槛设计：** "填色游戏"式的服装设计体验
2. **秒级生成：** 快速生成个性化3D形象
3. **实时试衣：** 流畅的虚拟试衣体验
4. **云端同步：** 设计作品云端保存，随时访问
5. **异步处理：** 避免UI卡顿，优化用户体验

## 未来展望

### 技术发展方向
1. **照片级建模：** 利用摄影测量法实现"照片级"真实感建模
2. **专业设计工具：** 打造"移动端CLO3D"级别的专业设计体验
3. **物理仿真：** 实现PBR物理布料模拟
4. **参数化编辑：** 支持参数化版型编辑功能

### 应用场景扩展
1. **个性化定制电商：** 为电商平台提供虚拟试衣解决方案
2. **虚拟社交形象：** 为社交平台提供3D形象服务
3. **康复辅具评估：** 在医疗康复领域的应用探索
4. **时尚设计教育：** 为设计教育提供实践平台

---
